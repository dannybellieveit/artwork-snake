<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>DannyCasio File Share</title>
  <base href="/" />
  <link rel="stylesheet" href="style.css">
  <style>
    body { margin:0; background:#87CEEB; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif; color:#000; }
    header { position:relative; background:#fff; padding:1rem; box-shadow:0 2px 4px rgba(0,0,0,0.1); text-align:center; }
    .back-btn { position:absolute; left:1rem; top:1rem; text-decoration:none; color:#000; font-size:1rem; }
    main { max-width:800px; margin:4rem auto 2rem; background:#fff; padding:2rem; border-radius:8px; }
    .file-item { margin-bottom:1.5rem; border-bottom:1px solid #ececec; padding-bottom:1rem; }
    .file-item h2 { margin:0 0 .5rem; font-size:1.25rem; }
    .file-item audio { width:100%; margin:.5rem 0; }
    .file-item a.download { display:inline-block; margin-top:.5rem; background:#0070f3; color:#fff; padding:.5rem 1rem; border-radius:4px; text-decoration:none; }
    .file-item a.download:hover { background:#005bb5; }
  </style>
</head>
<body>
  <header>
    <a class="back-btn" href="https://dannycasio.com">← Back to Home</a>
    <h1>DannyCasio File Portal</h1>
  </header>
  <main id="drop-content">
    <p>Loading files…</p>
  </main>
<script>
  (async () => {
    // 1. Extract share token
    const params = new URLSearchParams(location.search);
    let token = params.get('token');
    if (!token) {
      const m = location.pathname.match(/^\/drop\/([^/]+)$/);
      token = m && m[1];
    }
    const container = document.getElementById('drop-content');
    if (!token) {
      container.innerHTML = '<p>No share token provided.</p>';
      return;
    }

    // 2. Fetch file list JSON from Worker
    let files;
    try {
      const res = await fetch(`/list-proxy/${token}`);
      if (!res.ok) throw new Error(res.status);
      files = await res.json();
    } catch (err) {
      container.innerHTML = '<p>Error loading files.</p>';
      console.error(err);
      return;
    }

    // 3. Render the list
    if (files.length === 0) {
      container.innerHTML = '<p>No files found.</p>';
      return;
    }
    container.innerHTML = ''; // clear “Loading…”

    files.forEach(f => {
      const section = document.createElement('section');
      section.className = 'file-item';

      const h2 = document.createElement('h2');
      h2.textContent = f.name;
      section.appendChild(h2);

      if (f.name.match(/\.(mp3|wav|ogg)$/i)) {
        const audio = document.createElement('audio');
        audio.controls = true;
        audio.src = f.url;
        section.appendChild(audio);
      }

      const a = document.createElement('a');
      a.className = 'download';
      a.href = f.url;
      a.textContent = 'Download';
      a.setAttribute('download', f.name);
      section.appendChild(a);

      container.appendChild(section);
    });
  })();
</script>

</body>
</html>
